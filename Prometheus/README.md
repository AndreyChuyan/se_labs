# 🚀 Подготовка окружения для лабораторной работы

## 📚 Общие инструкции по подключению

Все подробные шаги по подключению к ВМ, установке OpenVPN, SSH и диагностике проблем находятся в основном репозитории:

👉 **https://github.com/AndreyChuyan/se_labs**

**Обязательно выполните шаги:**
- [🚀 Инструкция по настройке окружения для работы](https://github.com/AndreyChuyan/se_labs#-инструкция-по-настройке-окружения-для-работы)
- [❓ ЧАВО (Часто Задаваемые Вопросы)](https://github.com/AndreyChuyan/se_labs#-чаво-часто-задаваемые-вопросы)
- [🔧 Траблшутинг: пошаговая диагностика](https://github.com/AndreyChuyan/se_labs#-траблшутинг-пошаговая-диагностика)

---

# 📋 Чек-лист: День 3 — финальная проверка мониторинг-стека

Это **специфичное** для курса Prometheus. Выполните после успешного подключения к ВМ:

## Запуск мониторинг-стека

```bash
cd git
make
make up-app
make up-grafana
make up-alertmanager
sleep 60  # Дождитесь инициализации контейнеров (обычно 60 сек)
docker ps  
# Проверьте, все ли сервисы запущены
#<
CONTAINER ID   ...  STATUS         ...   NAMES
17159099579c   ...  Up 2 minutes   ...   alertmanager
385b145e56ac   ...  Up 2 minutes   ...   grafana
42e80d9843ff   ...  Up 2 minutes   ...   load-generator
981066d09609   ...  Up 2 minutes   ...   prometheus
7cb8325c8238   ...  Up 2 minutes   ...   orders-api
#>
```

## Проверка доступа к сервисам

```bash
curl -s -o /dev/null -w "%{http_code}\n" http://localhost:8080/health # 200 - Orders API доступен:
curl -s -o /dev/null -w "%{http_code}\n" http://localhost:9090/graph # 200 - Prometheus доступен
curl -s -o /dev/null -w "%{http_code}\n" http://localhost:3000 # 200 - Grafana доступен
curl -s -o /dev/null -w "%{http_code}\n" http://localhost:9093/ # 200 - Alertmanager доступен
```

## Доступ через браузер

Если подключены к ВМ через VS Code Remote SSH, форвадинг портов работает **автоматически**!

Откройте в браузере:
- Orders API:     `http://localhost:8080`
- Prometheus:     `http://localhost:9090`
- Grafana:        `http://localhost:3000`
- Alertmanager:   `http://localhost:9093`

**Если форвадинг не сработал автоматически:**
1. Откройте **Panel → Ports** в VS Code (Ctrl+Shift+M)
2. Нажмите **"Forward a Port"** и добавьте:
   - `8080` для Orders API
   - `9090` для Prometheus
   - `3000` для Grafana
   - `9093` для Alertmanager
3. Затем откройте в браузере `http://localhost:PORT`

---

# ⚠️ Типичные проблемы с мониторинг-стеком

## Проблема: "Prometheus/Grafana не доступны по портам 9090/3000"

**Решение:**

1. **Проверьте, запущены ли контейнеры:**
   ```bash
   docker ps
   ```
   Должны быть контейнеры prometheus, grafana и orders-api в статусе "Up"

2. **Если контейнеры не запущены, запустите их:**
   ```bash
   cd git
   make
   make up-app
   make up-grafana
   make up-alertmanager
   ```

3. **Проверьте логи контейнеров:**
   ```bash
   docker logs prometheus
   docker logs grafana
   docker logs orders-api
   ```

4. **Попробуйте достучаться к портам с ВМ:**
   ```bash
   curl http://localhost:8080/health  # Orders API
   curl http://localhost:9090         # Prometheus
   curl http://localhost:3000         # Grafana
   ```

5. **Если работает с ВМ, но не с вашего компьютера:**
   - Убедитесь, что VPN подключен
   - Попробуйте открыть в браузере: `http://192.168.2.XX:9090` (Prometheus) или `http://192.168.2.XX:3000` (Grafana)
   - Может быть, нужно открыть порты в firewall на ВМ

---

# 📚 Краткий ликбез: Grafana для новичков (5 мин)

Если вы первый раз видите Grafana, это не страшно! Вот основные элементы интерфейса:

## Главное меню (слева)

```
☰ Menu
├─ Home          → Главная страница с недавними дашбордами
├─ Dashboards    → Список всех дашбордов (визуализации метрик)
├─ Explore       → Прямой запрос к Prometheus (для анализа)
├─ Alerts        → Алерты и их состояние
├─ Configuration → Настройки (datasources, users, plugins)
└─ Help          → Справка
```

## Что такое Dashboard?

**Dashboard** — это набор графиков, показывающих метрики вашего приложения в реальном времени.

Пример:
```
┌────────────────────────────────────────────┐
│  Orders API - SA View          ⚙️ Settings │
├────────────────────────────────────────────┤
│ ┌──────────────┐  ┌──────────────┐       │
│ │   RPS        │  │ Error Rate   │       │
│ │   50 req/s   │  │   0.05 %     │       │
│ └──────────────┘  └──────────────┘       │
│                                          │
│ ┌──────────────────────────────────────┐ │
│ │      Latency P95 by Endpoint        │ │
│ │      /orders     300ms              │ │
│ │      /search     250ms              │ │
│ │      /health      10ms              │ │
│ └──────────────────────────────────────┘ │
└────────────────────────────────────────────┘
```

## Основные типы визуализаций

| Тип | Выглядит как | Для чего |
|-----|-------------|---------|
| **Graph** | Линия, идущая вверх-вниз | Метрики во времени (RPS, latency) |
| **Stat** | Большая цифра (19.35%) | Одно число, часто с цветом (хорошо/плохо) |
| **Bar chart** | Столбцы | Сравнение (топ 5 endpoints) |
| **Pie chart** | Круговая диаграмма | Распределение (% ошибок по типам) |
| **Table** | Таблица | Детальные данные в строках |

## Читаем показатель: "P95 latency = 300ms"

**Что это значит?**
> 95% пользователей получают ответ быстрее 300ms.  
> 5% пользователей ждут дольше (может быть, до 3 сек).

На графике:
```
Latency (ms)
    |
3s  |     •
    |    • •  
2s  |   •   •  ← 5% пользователей здесь (медленно)
    |  •     •
1s  | •       •
    |•         •
0   |___________________
    Time
    ↑
    P95 = 300ms ← 95% запросов быстрее этой линии
```

## Как создать простой график в Grafana

**На занятии разбираемся подробно, но вот общий принцип:**

1. **New Dashboard** → кнопка "+" или меню
2. **Add Visualization** → выбрать тип графика (Graph, Stat и т.д.)
3. **Query** → написать запрос к Prometheus:
   ```
   sum(rate(http_requests_total[5m]))
   ```
   (это означает: "Сумма всех запросов в секунду за последние 5 минут")
4. **Titles & Labels** → дать название графику и осям
5. **Save** → сохранить дашборд с именем

---

# 📞 Связь с организаторами

Если что-то не работает **после выполнения всех пунктов выше**:

## Как сообщить о проблеме:

1. **Отправьте в чат/email:**
   - Ваше имя
   - IP ВМ из таблицы (192.168.2.XX)
   - Что именно не получается (VPN / SSH / Docker / Prometheus / Grafana)
   - На каком шаге инструкции застряли
   - **Весь текст error message** (скриншот + текст ошибки)
   - Результат диагностических команд (ping, ssh -v, docker ps, curl и т.д.)

2. **Пример хорошего сообщения:**
   ```
   Привет! Я Петров Михаил (192.168.2.90)
   
   Проблема: Prometheus не доступен по порту 9090
   Ошибка: "Connection refused"
   
   Выполненные шаги:
   ✓ VPN подключен (ping 192.168.2.90 работает)
   ✓ SSH работает
   ✓ Контейнеры запущены (docker ps показывает prometheus, grafana, orders-api)
   
   Последний вывод:
   $ curl http://localhost:9090
   Connection refused
   
   Диагностика:
   $ docker logs prometheus
   [вывод логов]
   
   Скриншот ошибки: [приложен]
   ```

## Контакты:
- **Telegram:** @AndreyChuyan

---

# 🎯 После подготовки

Когда все пункты чек-листа ✅ выполнены:

1. **Напишите в чат:** "✅ @username готов к лабе"
2. **На занятии мы:**
   - Синхронизируем уровень подготовки (5-10 минут про интерфейс Grafana)
   - Подготовим мониторинг-стек вместе
   - Покажем, как читать метрики Prometheus
   - Научим создавать дашборды в Grafana с нуля
   - Разберемся с алертами и инцидентами
   - Сделаем 3-4 паузы для отдыха и вопросов

3. **Вы сможете:**
   - Самостоятельно мониторить приложение
   - Находить узкие места в производительности
   - Писать требования (SLA/SLO) на основе данных
   - Настраивать уведомления об инцидентах

---

# 📋 Справочные материалы по SE Labs

**Основной репозиторий:** https://github.com/AndreyChuyan/se_labs  
**Траблшутинг:** https://github.com/AndreyChuyan/se_labs#-траблшутинг-пошаговая-диагностика  
**ЧАВО:** https://github.com/AndreyChuyan/se_labs#-чаво-часто-задаваемые-вопросы

